<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZEDæŒ‰é”®åŠ©æ‰‹ by ç ´äºšç©º-Yakong-P</title>
    <style>
        body {
            /* font-family: ui-sans-serif; */
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        .binding-list_advanced {
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
        }

        .binding-item_advanced {
            background-color: #fff;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .binding-item_advanced span {
            display: block;
            margin-bottom: 5px;
        }

        .template-list_advanced {
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
        }

        .template-item_advanced {
            background-color: #fff;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .template-item_advanced span {
            display: block;
            margin-bottom: 5px;
        }

        .input-group {
            margin: 10px 0;
        }

        input[type="text"] {
            padding: 5px;
            width: 100%;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        .button-group {
            margin-top: 20px;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        #dropArea {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            box-sizing: border-box;
            border: 3px dashed #4CAF50;
            font-size: 2em;
            background-color: rgba(76, 175, 80, 0.1);
            text-align: center;
            /*   padding: 20px; */
            border-radius: 0;
            white-space: pre-line;
            /* Ensures that newline characters are respected */
            z-index: 10;
            cursor: pointer;
            /* é¼ æ ‡æŒ‡é’ˆæç¤º */
        }

        .hidden {
            display: none !important;
            /* å¼ºåˆ¶éšè— */
        }

        .advanced {
            display: none !important;
            /* å¼ºåˆ¶éšè— */
        }

        .advanced-edit-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }

        .advanced-field-wrapper {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .advanced-label {
            margin-bottom: 5px;
            font-weight: bold;
        }

        .advanced-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .advanced-input.single-line {
            height: 40px;
        }

        .advanced-input.multi-line {
            min-height: 100px;
            resize: vertical;
        }

        #addBindingButton {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 10px;
            background-color: #ffcc00;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            width: 50px;
            height: 50px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 4px #ad8b00;
            /* åˆ›å»ºæŒ‰é’®ä¸‹æ–¹çš„é˜´å½± */
        }

        #addBindingButton:hover {
            background-color: #d4aa00;
        }

        #addBindingButton:active {
            box-shadow: 0 2px #ad8b00;
            /* æŒ‰ä¸‹æ—¶é˜´å½±å‡å° */
            transform: translateY(4px);
            /* æŒ‰é’®ä¸‹ç§»çš„æ•ˆæœ */
        }


        /* æ¨¡æ€æ¡†æ ·å¼ */
        #bindingModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
        }

        .modal-content {
            background: #fff;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            width: 400px;
            /* ç¡®ä¿å†…å®¹å®½åº¦ä¸€è‡´ */
            max-width: 90%;
            /* é˜²æ­¢çª—å£å¤ªçª„æ—¶æº¢å‡º */
        }

        .modal-content h3 {
            margin: 0 0 20px 0;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input {
            width: 95%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .button-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .button-group button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .button-group button#saveBindingButton {
            background-color: #4CAF50;
            color: white;
        }

        .button-group button#saveBindingButton:hover {
            background-color: #45a049;
        }

        .button-group button#cancelBindingButton {
            background-color: #f44336;
            color: white;
        }

        .button-group button#cancelBindingButton:hover {
            background-color: #e53935;
        }

        /* ä¸ºè¾“å…¥æ¡†å…è®¸å¤šè¡Œæ˜¾ç¤ºå¢åŠ æ ·å¼ */
        textarea {
            width: 95%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            resize: none;
            /* å…è®¸ç”¨æˆ·è°ƒæ•´é«˜åº¦ */
            min-height: 10px;
            /* æœ€å°é«˜åº¦ */
        }

        /* è®¾ç½®å®¹å™¨å®½åº¦ã€å¸ƒå±€å’Œå¯¹é½ */
        #bindingList {
            display: flex;
            flex-direction: column;
            width: 80%;
            /* æ”¹ä¸º100% */
            max-width: 600px;
            /* ä¿æŒæœ€å¤§å®½åº¦ */
            margin: 0 auto;
            /* å±…ä¸­ */
            padding: 0;
            /* æ·»åŠ ä¸€äº›æ°´å¹³å†…è¾¹è· */
            box-sizing: border-box;
            gap: 10px;
        }

        /* è®¾ç½®å®¹å™¨å®½åº¦ã€å¸ƒå±€å’Œå¯¹é½ */
        #templateList {
            display: flex;
            flex-direction: column;
            width: 80%;
            /* æ”¹ä¸º100% */
            max-width: 600px;
            /* ä¿æŒæœ€å¤§å®½åº¦ */
            margin: 10px auto;
            /* å±…ä¸­ */
            padding: 0;
            /* æ·»åŠ ä¸€äº›æ°´å¹³å†…è¾¹è· */
            box-sizing: border-box;
            gap: 10px;
        }

        /* æ¯ä¸ªæŒ‰é”®ç»‘å®šçš„è¡Œ */
        .binding-item {
            display: block;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            background-color: #fff;
            cursor: grab;
        }

        /* æè¿°éƒ¨åˆ† */
        .binding-item .description {
            flex: 0;
            text-align: left;
            /* å‘å·¦å¯¹é½ */
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            padding-right: 10px;
            /* ä¸æŒ‰é’®ä¹‹é—´ç•™ä¸€äº›ç©ºé—´ */
        }

        /* æŒ‰é’®æ ·å¼ */
        .binding-item button {
            display: inline-flex;
            flex-shrink: 0;
            /* é˜²æ­¢æŒ‰é’®è¢«æŒ¤å‹ */
            min-width: 45px;
            height: 40px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            /* æ”¹ä¸ºæ–¹å½¢ */
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-left: auto;
            /* å°†æŒ‰é’®æ¨åˆ°æœ€å³ä¾§ */
            box-shadow: 0 4px #2e7d32;
            /* åˆ›å»ºæŒ‰é’®ä¸‹æ–¹çš„é˜´å½± */
        }

        /* æŒ‰é’®æ‚¬æµ®æ•ˆæœ */
        .binding-item button:hover {
            background-color: #45a049;
        }

        /* æ¯ä¸ªæŒ‰é”®ç»‘å®šçš„è¡Œ */
        .template-item {
            display: block;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            background-color: #fff;
        }

        /* æè¿°éƒ¨åˆ† */
        .template-item .description {
            flex: 0;
            text-align: left;
            /* å‘å·¦å¯¹é½ */
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
            padding-right: 10px;
            /* ä¸æŒ‰é’®ä¹‹é—´ç•™ä¸€äº›ç©ºé—´ */
        }

        /* æŒ‰é’®æ ·å¼ */
        .template-item button {
            display: inline-flex;
            flex-shrink: 0;
            /* é˜²æ­¢æŒ‰é’®è¢«æŒ¤å‹ */
            min-width: 45px;
            height: 40px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            /* æ”¹ä¸ºæ–¹å½¢ */
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-left: auto;
            /* å°†æŒ‰é’®æ¨åˆ°æœ€å³ä¾§ */
            box-shadow: 0 4px #2e7d32;
            /* åˆ›å»ºæŒ‰é’®ä¸‹æ–¹çš„é˜´å½± */
        }

        /* æŒ‰é’®æ‚¬æµ®æ•ˆæœ */
        .template-item button:hover {
            background-color: #45a049;
        }

        .keyDetectorOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 2em;
            text-align: center;
        }

        #Info {
            position: fixed;
            top: 20px;
            right: 20px;
        }

        .togglerList {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            /* è®¾ç½®ä¸º flex å¸ƒå±€ */
            justify-content: flex-end;
            /* æ°´å¹³æ–¹å‘å³å¯¹é½ */
            align-items: flex-end;
            /* å‚ç›´æ–¹å‘åº•éƒ¨å¯¹é½ */
            flex-direction: column-reverse;
            /* 20241214:ä¿®å¤é˜»æŒ¡é—®é¢˜ */
            pointer-events: none;
        }

        .toggler {
            display: block;
            /* ä½¿æŒ‰é’®å †å  */
            align-items: end;
            /* å³å¯¹é½ */
            margin-bottom: 10px;
            /* æŒ‰é’®ä¹‹é—´çš„é—´è· */
            font-size: 24px;
            padding: 20px;
            /* width: 136px; */
            height: 71px;
            background-color: #4CAF50;
            color: white;
            /* åˆ›å»ºæŒ‰é’®ä¸‹æ–¹çš„é˜´å½± */
            box-shadow: 0 4px #2e7d32;
            /* 20241214:ä¿®å¤é˜»æŒ¡é—®é¢˜ */
            pointer-events: auto;
        }

        /* 20241214:å›ºå®š[å…³äº]çš„æŒ‰é’®å®½åº¦ */
        #Info {
            width: 136px;
        }

        .toggler:active {
            box-shadow: 0 2px #2e7d32;
            /* æŒ‰ä¸‹æ—¶é˜´å½±å‡å° */
            transform: translateY(4px);
            /* æŒ‰é’®ä¸‹ç§»çš„æ•ˆæœ */
        }

        /* æœç´¢æ¡†å®¹å™¨ */
        #searchContainer {
            max-width: 600px;
            width: 80%;
            margin: 20px auto;
            text-align: center;
        }

        /* æœç´¢æ¡†æ ·å¼ */
        #searchBox {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }


        /* æ¶ˆæ¯æ¡† */
        .popupContainerCSS {
            position: relative;
            top: 0px;
            left: 0px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-end;
            pointer-events: auto;
            /* 20241214:ä¿®å¤é˜»æŒ¡é—®é¢˜ */
            user-select: none;
            /* 20241214:é˜²æ­¢æ–‡å­—é€‰ä¸­ */
        }

        .popup {
            width: fit-content;
            background: white;
            margin-bottom: 10px;
            /* æ¯ä¸ªå…ƒç´ åº•éƒ¨ä¹‹é—´çš„é—´éš” */
            padding: 25px 30px;
            /* å†…è¾¹è· */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
            border: 2px solid #007BFF;
            /* æ˜æ˜¾çš„è“è‰²è¾¹æ¡† */
            border-radius: 12px;
            top: 20px;
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            opacity: 1;
            transition: opacity 0.5s ease-out;
            z-index: 1000;
        }

        .popup.fade-out {
            opacity: 0;
        }

        .off {
            /* white blackground */
            background-color: #d6e4d6 !important;
            box-shadow: 0 2px #bdd3bd !important;
        }

        .on {
            background-color: #4CAF50;
        }

        .warm {
            background-color: #ffcc00 !important;
            box-shadow: 0 2px #ad8b00 !important;
        }

        .hot {
            background-color: #ff5722 !important;
        }

        /* åƒåœ¾æ¡¶æ ·å¼ */
        #trashBin {
            position: fixed;
            bottom: 20px;
            left: 20px;
            font-size: 80px;
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s, opacity 0.2s;
            opacity: 0.7;
            padding: 20px;
            /* å¢åŠ å¯ç‚¹å‡»åŒºåŸŸ */
            background-color: rgba(128, 128, 128, 0.1);
            /* æ·»åŠ èƒŒæ™¯ */
            border-radius: 10px;
        }

        #trashBin.drag-over {
            transform: scale(1.2);
            opacity: 1;
            background-color: rgba(255, 0, 0, 0.1);
            /* é«˜äº®èƒŒæ™¯ */
        }

        #trashBin.hidden {
            display: none !important;
        }

        /* Style for the clip bin, similar to trash bin */
        #copyBin {
            position: fixed;
            top: 35%;
            /* Positioned above the trash bin */
            left: 20px;
            font-size: 80px;
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s, opacity 0.2s;
            opacity: 0.7;
            padding: 20px;
            background-color: rgba(128, 128, 128, 0.1);
            border-radius: 10px;
        }

        #copyBin.drag-over {
            transform: scale(1.2);
            opacity: 1;
            background-color: rgba(0, 255, 0, 0.1);
            /* Green highlight for copy */
        }

        #copyBin.hidden {
            display: none !important;
        }

        /* Style for the copy bin, similar to trash bin */
        #clipBin {
            position: fixed;
            top: 20px;
            /* Positioned above the trash bin */
            left: 20px;
            font-size: 80px;
            cursor: pointer;
            z-index: 1000;
            transition: transform 0.2s, opacity 0.2s;
            opacity: 0.7;
            padding: 20px;
            background-color: rgba(128, 128, 128, 0.1);
            border-radius: 10px;
        }

        #clipBin.drag-over {
            transform: scale(1.2);
            opacity: 1;
            background-color: rgba(0, 255, 0, 0.1);
            /* Green highlight for copy */
        }

        #clipBin.hidden {
            display: none !important;
        }

        .draggable {
            /*             transition:
                transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.2s; */
            /*             cursor: move; */
        }

        .binding-item.drag-move-down {
            transform: translate(0px, 10px);
        }

        .binding-item.drag-move-up {
            transform: translate(0px, -10px);
        }

        .draggable:hover {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .draggable.drag-over {
            /* transform: scale(0.98); */
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
            /*             border: 2px dashed #4CAF50; */
        }

        .drag-item {
            transform: scale(1.02);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.2);
            border: 2px dashed #4CAF50;
        }
    </style>
</head>

<body>

    <h1 id="appTitle" class="hidden">CS2 æŒ‰é”®ç»‘å®šåŠ©æ‰‹ for ZED (2024-12-14)</h1>

    <div id="dropArea">ç‚¹å‡»æ‰“å¼€ï¼Œæˆ–ç›´æ¥æ‹–æ‹½æ”¾ç½® ğŸ“„ poyakong.cfg</div>
    <button id="addBindingButton" class="hidden advanced">+</button>
    <button id="Info" class="hidden toggler">å…³äº</button>
    <div class="togglerList">
        <button id="autoSaveButton" class="hidden toggler">è‡ªåŠ¨ä¿å­˜</button>
        <button id="advancedModeButton" class="hidden toggler">é«˜çº§æ¨¡å¼</button>
        <button id="exportSettingsButton" class="hidden toggler">è®¾ç½®å¯¼å‡º</button>
        <button id="importSettingsButton" class="hidden toggler advanced">è®¾ç½®å¯¼å…¥</button>
        <button id="clipboardButton" class="hidden toggler">å¤åˆ¶åˆ°å‰ªåˆ‡æ¿</button>
        <button id="autoClipboardButton" class="hidden toggler">è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªåˆ‡æ¿[âˆš]</button>
        <div id="popupContainer" class="popupContainerCSS"></div>
    </div>
    <div id="searchContainer" class="hidden">
        <input type="text" id="searchBox" placeholder="å…¨å±€æœç´¢..." />
    </div>
    <div id="bindingList" class="binding-list hidden"></div>
    <div id="templateList" class="template-list hidden"></div>
    <div id="clipBin" class="hidden" title="æ‹–æ”¾åˆ°è¿™ï¼Œå¤åˆ¶åˆ°å‰ªåˆ‡æ¿">ğŸ“‹</div>
    <div id="copyBin" class="hidden" title="æ‹–æ”¾åˆ°è¿™ï¼Œå¯ä»¥å¤šç»‘">ğŸ“‘</div>
    <div id="trashBin" class="hidden" title="æ‹–æ”¾åˆ°è¿™ï¼Œè¿›è¡Œåˆ é™¤">ğŸ—‘ï¸</div>


    <div id="bindingModal" class="hidden">
        <div class="modal-content">
            <h3>æ·»åŠ æ–°ç»‘å®š</h3>
            <div class="input-group">
                <label for="descriptionInput">Description:</label>
                <input type="text" id="descriptionInput" placeholder="ä¾‹å¦‚ï¼šå‘å‰ç§»åŠ¨"></textarea>
            </div>
            <div class="input-group">
                <label for="bindInput">Bind (å¯é€‰):</label>
                <input type="text" id="bindInput" placeholder="ä¾‹å¦‚ï¼šw"></textarea>
            </div>
            <div class="input-group">
                <label for="commandInput">Command:</label>
                <textarea id="commandInput" placeholder="ä¾‹å¦‚ï¼šbind [key] +forward"></textarea>
            </div>
            <div class="input-group">
                <label for="tagInput">Tag (é€—å·åˆ†éš”ï¼Œå¯å¤šè¡Œ):</label>
                <input type="text" id="tagInput" placeholder="ä¾‹å¦‚ï¼šç§»åŠ¨, åŸºæœ¬è®¾ç½®"></textarea>
            </div>
            <div class="button-group">
                <button id="saveBindingButton">ä¿å­˜</button>
                <button id="cancelBindingButton">å–æ¶ˆ</button>
            </div>
        </div>
    </div>


    <script>
        let currentFile = null;
        const dropArea = document.getElementById('dropArea');
        const bindingListElement = document.getElementById('bindingList');
        const templateListElement = document.getElementById('templateList');
        const addBindingButton = document.getElementById('addBindingButton');    // æ–°å¢ç»‘å®šæŒ‰é’®
        const advancedModeButton = document.getElementById('advancedModeButton');    // è¿›é˜¶æ¨¡å¼æŒ‰é’®
        let advancedMode = false;    // è¿›é˜¶æ¨¡å¼
        const autoSaveButton = document.getElementById('autoSaveButton');    // è‡ªåŠ¨ä¿å­˜æŒ‰é’®
        let autoSaveMode = false;    // è‡ªåŠ¨ä¿å­˜æ¨¡å¼
        const exportSettingsButton = document.getElementById('exportSettingsButton');    // å¯¼å‡ºè®¾ç½®æŒ‰é’®
        const importSettingsButton = document.getElementById('importSettingsButton');    // å¯¼å…¥è®¾ç½®æŒ‰é’®
        const clipboardButton = document.getElementById('clipboardButton');    // å¤åˆ¶åˆ°å‰ªåˆ‡æ¿æŒ‰é’®
        const autoClipboardButton = document.getElementById('autoClipboardButton');    // è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªåˆ‡æ¿æŒ‰é’®
        let autoClipboardMode = true;    // è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªåˆ‡æ¿æ¨¡å¼
        const Info = document.getElementById('Info');    // å…³äºæŒ‰é’®

        const searchContainer = document.getElementById('searchContainer');
        const searchBox = document.getElementById('searchBox');

        // å½©è›‹
        let secretCounter = 0;

        let bindings = [];
        let templates = [];
        let bindingsFilter = () => bindings; // åˆå§‹ç­›é€‰å‡½æ•°ï¼Œè¿”å›å®Œæ•´æ•°ç»„
        let templatesFilter = () => templates; // åˆå§‹ç­›é€‰å‡½æ•°ï¼Œè¿”å›å®Œæ•´æ•°ç»„

        // 20250117 cookies support ğŸª {color:#784D37}
        let cookiesEnabled = false;

        // 20250118 localstorage support ğŸ—„ {color:#784D37}
        let localStorageEnabled = true;

        // 20250120 exec autoexec.cfg
        let needAutoExec = true;

        // Get trash bin element
        const trashBin = document.getElementById('trashBin');
        // ä¸ºåƒåœ¾æ¡¶æ·»åŠ æ‹–æ”¾äº‹ä»¶
        trashBin.addEventListener('dragover', trashBinDragOver);
        trashBin.addEventListener('dragleave', trashBinDragLeave);
        trashBin.addEventListener('drop', trashBinDrop);

        // Get copy bin element
        const copyBin = document.getElementById('copyBin');
        // Add events for copy bin
        copyBin.addEventListener('dragover', copyCopyBinDragOver);
        copyBin.addEventListener('dragleave', copyCopyBinDragLeave);
        copyBin.addEventListener('drop', copyCopyBinDrop);


        // Get clip bin element
        const clipBin = document.getElementById('clipBin');
        // Add events for clip bin
        clipBin.addEventListener('dragover', clipBinDragOver);
        clipBin.addEventListener('dragleave', clipBinDragLeave);
        clipBin.addEventListener('drop', clipBinDrop);

        const bindingModal = document.getElementById('bindingModal');
        const saveBindingButton = document.getElementById('saveBindingButton');
        const cancelBindingButton = document.getElementById('cancelBindingButton');

        const appTitle = document.getElementById('appTitle');

        // æ˜¾ç¤ºæ¨¡æ€æ¡†
        function showBindingModal() {
            bindingModal.classList.remove('hidden');
        }

        // éšè—æ¨¡æ€æ¡†
        function hideBindingModal() {
            bindingModal.classList.add('hidden');
        }

        // æ˜¾ç¤ºæ¶ˆæ¯æ¡†
        function showPopup(message, containerId = "popupContainer") {
            // Find the container by ID
            const container = document.getElementById(containerId);

            // Create a new popup element
            const popup = document.createElement('div');
            popup.classList.add('popup');
            popup.style.whiteSpace = 'pre-line'; // å…è®¸æ¢è¡Œ
            popup.innerHTML = message;

            // Append it to the specified container
            container.appendChild(popup);

            // Automatically fade out and remove the popup
            setTimeout(() => {
                popup.classList.add('fade-out');
                popup.addEventListener('transitionend', () => popup.remove());
            }, 5000); // Popup stays for 5 seconds
        }

        // ä¿å­˜ç»‘å®šé€»è¾‘
        saveBindingButton.addEventListener('click', () => {
            const descriptionInput = document.getElementById('descriptionInput').value.trim();
            const bindInput = document.getElementById('bindInput').value.trim();
            const commandInput = document.getElementById('commandInput').value.trim();
            const tagInput = document.getElementById('tagInput').value.trim();

            if (descriptionInput && commandInput) {
                templates.push({
                    description: descriptionInput,
                    bind: bindInput || "", // bind ä¸ºç©ºæ—¶è®¾ä¸ºé»˜è®¤ç©ºå­—ç¬¦ä¸²
                    command: commandInput,
                    tag: tagInput.split(/[,ï¼Œ]/).map(tag => tag.trim()).filter(tag => tag)
                });
                renderBindings();
                hideBindingModal();
            } else {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹ (Description å’Œ Command)ï¼');
            }
        });

        // å–æ¶ˆæŒ‰é’®é€»è¾‘
        cancelBindingButton.addEventListener('click', hideBindingModal);

        // ç»‘å®š "+" æŒ‰é’®çš„äº‹ä»¶
        addBindingButton.addEventListener('click', showBindingModal);

        // ç»‘å®šæœç´¢åŠŸèƒ½
        searchBox.addEventListener("input", () => {
            const query = searchBox.value.trim().toLowerCase();
            const queryWords = query.split(/\s+/);
            // è¿‡æ»¤å‡½æ•°ï¼šæ¯ä¸ªå•è¯éƒ½è¦åœ¨descriptionä¸­å‡ºç°
            bindingsFilter = () => bindings.filter(binding =>
                queryWords.every(word => binding.description.toLowerCase().includes(word)) // æ‰€æœ‰å•è¯éƒ½éœ€è¦åŒ¹é…
            );

            templatesFilter = () => templates.filter(template =>
                queryWords.every(word => template.description.toLowerCase().includes(word)) // æ‰€æœ‰å•è¯éƒ½éœ€è¦åŒ¹é…
            );
            renderBindings(); // æ ¹æ®ç­›é€‰ç»“æœé‡æ–°æ¸²æŸ“
            renderTemplates();
        });

        // é‡å†™ renderBindings ä»¥ç¡®ä¿æ¯æ¬¡æ¸²æŸ“åé‡æ–°ç»‘å®šæ‹–æ”¾äº‹ä»¶
        function renderBindings(passingBindings = bindings) {
            // åŸæœ‰çš„æ¸²æŸ“é€»è¾‘ä¿æŒä¸å˜
            const originalRenderResult = originalRenderBindings();

            // é‡æ–°ç»‘å®šæ‹–æ”¾äº‹ä»¶
            attachDragEvents();

            return originalRenderResult;
        }


        // æ ¸å¿ƒæ¸²æŸ“
        function originalRenderBindings(passingBindings = bindingsFilter) {
            // å¦‚æœ passingBindings æ˜¯å‡½æ•°ï¼Œåˆ™è°ƒç”¨å®ƒè·å–ç»“æœ
            const dataToRender = typeof passingBindings === 'function'
                ? passingBindings()
                : passingBindings;

            if (!advancedMode) {

                bindingListElement.innerHTML = ''; // Clear existing content
                bindingListElement.classList.add('drag-list');

                dataToRender.forEach((bindingTemp, bindingTempIndex) => {
                    const originalIndex = bindings.indexOf(bindingTemp); // è·å–åŸå§‹ç´¢å¼•
                    const bindingItem = document.createElement('div');
                    bindingItem.setAttribute('data-original-index', originalIndex); // å­˜å‚¨åŸå§‹ç´¢å¼•
                    bindingItem.classList.add('binding-item', 'draggable');
                    bindingItem.setAttribute('draggable', true);
                    bindingItem.id = `binding-${bindingTempIndex}`;
                    bindingItem.setAttribute('title', bindingTemp.description); // æ·»åŠ title = description

                    // Create a container for layout
                    const itemContent = document.createElement('div');
                    itemContent.style.display = 'flex';
                    itemContent.style.justifyContent = 'space-between';
                    itemContent.style.alignItems = 'center';
                    itemContent.style.pointerEvents = 'none'; // 20241201-é˜²æ­¢åŠ¨ç”»ä¸¢å¤±

                    // Description text (left-aligned)
                    const descriptionSpan = document.createElement('span');
                    descriptionSpan.textContent = bindingTemp.description;
                    descriptionSpan.style.flex = '1';
                    descriptionSpan.style.textOverflow = 'ellipsis';
                    descriptionSpan.style.whiteSpace = 'nowrap';
                    descriptionSpan.style.overflow = 'hidden';
                    descriptionSpan.style.paddingLeft = '5px';
                    descriptionSpan.style.userSelect = 'none'; // 20241214-ä½¿æ–‡æœ¬ä¸å¯è¢«é€‰ä¸­

                    // 20241202-å¢åŠ å…¬å‘ŠåŠŸèƒ½
                    if (bindingTemp.tag && bindingTemp.tag[0] === ('å…¬å‘Š')) {
                        if (bindingTemp.tag[1] && bindingTemp.tag[2]) {
                            const hyperLink = document.createElement('a');
                            hyperLink.textContent = bindingTemp.tag[1];
                            hyperLink.href = bindingTemp.tag[2];
                            hyperLink.target = '_blank'; // åœ¨æ–°çª—å£å†…æ‰“å¼€
                            hyperLink.style.pointerEvents = 'auto'; // ä½¿å¾—è¶…é“¾æ¥å¯ä»¥è¢«ç‚¹å‡»
                            descriptionSpan.appendChild(hyperLink);
                        }
                    }

                    // Key setup button (right-aligned)
                    const keyButton = document.createElement('button');
                    keyButton.textContent = bindingTemp.bind || 'è®¾ç½®';
                    keyButton.style.pointerEvents = 'auto'; // 20241202-ä¿®å¤æŒ‰é’®ç‚¹å‡»é—®é¢˜

                    // Add click event to setup key
                    keyButton.addEventListener('click', () => {
                        setupKeyDetector().then((key) => {
                            if (key) {
                                // åŠŸèƒ½ä¸Šæ˜¯ä¸€æ ·çš„
                                // bindingTemp[bindingTempIndex].bind = key;
                                bindings[originalIndex].bind = key;
                                renderBindings();
                                showPopup(`å·²æ›´æ”¹ [${key}]â¡ï¸` + bindings[originalIndex].description, 'popupContainer');
                                // 20241214-autoClipboard
                                if (autoClipboardMode) {
                                    navigator.clipboard.writeText(extractAsCmd(bindings[originalIndex]));
                                    showPopup("â¤ï¸<span style='color: green;'>æŒ‡ä»¤å·²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ï¼Œæ§åˆ¶å°ç²˜è´´è¿è¡Œå³å¯</span>", 'popupContainer');
                                }
                            }
                        });
                    });

                    // Drag and drop event listeners
                    bindingItem.addEventListener('dragstart', dragStart);
                    bindingItem.addEventListener('dragover', dragOver);
                    bindingItem.addEventListener('drop', drop);
                    bindingItem.addEventListener('dragenter', dragEnter);
                    bindingItem.addEventListener('dragleave', dragLeave);

                    // Assemble the item
                    itemContent.appendChild(descriptionSpan);
                    itemContent.appendChild(keyButton);

                    bindingItem.appendChild(itemContent);
                    bindingListElement.appendChild(bindingItem);
                });

            } else {
                // Advanced mode with editable fields
                bindingListElement.innerHTML = '';
                dataToRender.forEach((bindingTemp, bindingTempIndex) => {
                    const originalIndex = bindings.indexOf(bindingTemp); // è·å–åŸå§‹ç´¢å¼•
                    const bindingItem = document.createElement('div');
                    bindingItem.setAttribute('data-original-index', originalIndex); // å­˜å‚¨åŸå§‹ç´¢å¼•
                    bindingItem.classList.add('binding-item_advanced');

                    // Create container for editable fields
                    const editContainer = document.createElement('div');
                    editContainer.classList.add('advanced-edit-container');

                    // Description input (single line)
                    const descriptionInput = document.createElement('input');
                    descriptionInput.type = 'text';
                    descriptionInput.value = bindingTemp.description;
                    descriptionInput.placeholder = 'Description';
                    descriptionInput.classList.add('advanced-input', 'single-line');

                    // Bind input (single line)
                    const bindInput = document.createElement('input');
                    bindInput.type = 'text';
                    bindInput.value = bindingTemp.bind;
                    bindInput.placeholder = 'Bind Key';
                    bindInput.classList.add('advanced-input', 'single-line');

                    // Command input (multi-line)
                    const commandInput = document.createElement('textarea');
                    commandInput.value = bindingTemp.command;
                    commandInput.placeholder = 'Command';
                    commandInput.classList.add('advanced-input', 'multi-line');

                    // Tag input (single line)
                    const tagInput = document.createElement('input');
                    tagInput.type = 'text';
                    tagInput.value = bindingTemp.tag.join(', ');
                    tagInput.placeholder = 'Tag (comma-separated)';
                    tagInput.classList.add('advanced-input', 'single-line');

                    // Add change event listeners to update the bindings
                    const updateBinding = () => {
                        bindings[originalIndex].description = descriptionInput.value;
                        bindings[originalIndex].bind = bindInput.value;
                        bindings[originalIndex].command = commandInput.value;
                        bindings[originalIndex].tag = tagInput.value.split(/[,ï¼Œ]/).map(tag => tag.trim()).filter(tag => tag);
                    };

                    descriptionInput.addEventListener('change', updateBinding);
                    bindInput.addEventListener('change', updateBinding);
                    commandInput.addEventListener('change', updateBinding);
                    tagInput.addEventListener('change', updateBinding);

                    // Create label for each input
                    const createLabel = (text) => {
                        const label = document.createElement('label');
                        label.textContent = text;
                        label.classList.add('advanced-label');
                        return label;
                    };

                    // Assemble the item
                    const fields = [
                        { label: 'Description:', input: descriptionInput },
                        { label: 'Bind:', input: bindInput },
                        { label: 'Command:', input: commandInput },
                        { label: 'Tag:', input: tagInput }
                    ];

                    fields.forEach(field => {
                        const fieldWrapper = document.createElement('div');
                        fieldWrapper.classList.add('advanced-field-wrapper');

                        const label = createLabel(field.label);
                        fieldWrapper.appendChild(label);
                        fieldWrapper.appendChild(field.input);

                        editContainer.appendChild(fieldWrapper);
                    });

                    bindingItem.appendChild(editContainer);
                    bindingListElement.appendChild(bindingItem);
                });
            }
        }

        // æ ¸å¿ƒæ¸²æŸ“
        function renderTemplates(passingTemplates = templatesFilter) {
            // å¦‚æœ passingTemplates æ˜¯å‡½æ•°ï¼Œåˆ™è°ƒç”¨å®ƒè·å–ç»“æœ
            const dataToRender = typeof passingTemplates === 'function'
                ? passingTemplates()
                : passingTemplates;

            if (!advancedMode) {
                templateListElement.innerHTML = ''; // Clear existing content
                templateListElement.classList.add('drag-list');

                dataToRender.forEach((templateTemp, templateTempIndex) => {
                    const originalIndex = templates.indexOf(templateTemp); // è·å–åŸå§‹ç´¢å¼•
                    const templateItem = document.createElement('div');
                    templateItem.setAttribute('data-original-index', originalIndex); // å­˜å‚¨åŸå§‹ç´¢å¼•
                    templateItem.classList.add('template-item');
                    templateItem.setAttribute('title', templateTemp.description);// æ·»åŠ title = description
                    // templateItem.classList.add('draggable');
                    // templateItem.setAttribute('draggable', true);
                    templateItem.id = `template-${templateTempIndex}`;

                    // Create a container for layout
                    const itemContent = document.createElement('div');
                    itemContent.style.display = 'flex';
                    itemContent.style.justifyContent = 'space-between';
                    itemContent.style.alignItems = 'center';

                    // Description text (left-aligned)
                    const descriptionSpan = document.createElement('span');
                    descriptionSpan.textContent = templateTemp.description;
                    descriptionSpan.style.flex = '1';
                    descriptionSpan.style.textOverflow = 'ellipsis';
                    descriptionSpan.style.whiteSpace = 'nowrap';
                    descriptionSpan.style.overflow = 'hidden';
                    descriptionSpan.style.paddingLeft = '5px';
                    descriptionSpan.style.userSelect = 'none'; // 20241214-ä½¿æ–‡æœ¬ä¸å¯è¢«é€‰ä¸­

                    // 20241202-å¢åŠ å…¬å‘ŠåŠŸèƒ½
                    if (templateTemp.tag && templateTemp.tag[0] === ('å…¬å‘Š')) {
                        if (templateTemp.tag[1] && templateTemp.tag[2]) {
                            const hyperLink = document.createElement('a');
                            hyperLink.textContent = templateTemp.tag[1];
                            hyperLink.href = templateTemp.tag[2];
                            hyperLink.target = '_blank'; // åœ¨æ–°çª—å£å†…æ‰“å¼€
                            hyperLink.style.pointerEvents = 'auto'; // ä½¿å¾—è¶…é“¾æ¥å¯ä»¥è¢«ç‚¹å‡»
                            descriptionSpan.appendChild(hyperLink);
                        }
                    }

                    // Key setup button (right-aligned)
                    const keyButton = document.createElement('button');
                    keyButton.textContent = templateTemp.bind || 'è®¾ç½®';

                    // Add click event to setup key
                    keyButton.addEventListener('click', () => {
                        setupKeyDetector().then((key) => {
                            if (key) {
                                const newBinding = {
                                    description: templateTemp.description,
                                    bind: key,
                                    command: templateTemp.command,
                                    tag: templateTemp.tag
                                };
                                bindings.push(newBinding);
                                renderBindings();
                                showPopup(`å·²ç»‘å®š[${key}]â¡ï¸` + templateTemp.description + "ï¼Œè¯·åœ¨ä¸Šæ–¹åˆ—è¡¨æŸ¥çœ‹", 'popupContainer');
                                if (autoClipboardMode) {
                                    navigator.clipboard.writeText(extractAsCmd(newBinding));
                                    showPopup("â¤ï¸<span style='color: green;'>æŒ‡ä»¤å·²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ï¼Œæ§åˆ¶å°ç²˜è´´è¿è¡Œå³å¯</span>", 'popupContainer');
                                }
                            }
                        });
                    });
                    // Drag and drop event listeners
                    // templateItem.addEventListener('dragstart', dragStart);
                    // templateItem.addEventListener('dragover', dragOver);
                    // templateItem.addEventListener('drop', drop);
                    // templateItem.addEventListener('dragenter', dragEnter);
                    // templateItem.addEventListener('dragleave', dragLeave);

                    // Assemble the item
                    itemContent.appendChild(descriptionSpan);
                    itemContent.appendChild(keyButton);

                    templateItem.appendChild(itemContent);
                    templateListElement.appendChild(templateItem);
                });
            } else {
                // Advanced mode with editable fields
                templateListElement.innerHTML = '';
                dataToRender.forEach((templateTemp, templateTempIndex) => {
                    const originalIndex = templates.indexOf(templateTemp); // è·å–åŸå§‹ç´¢å¼•
                    const templateItem = document.createElement('div');
                    templateItem.setAttribute('data-original-index', originalIndex); // å­˜å‚¨åŸå§‹ç´¢å¼•
                    templateItem.classList.add('template-item_advanced');

                    // Create container for editable fields
                    const editContainer = document.createElement('div');
                    editContainer.classList.add('advanced-edit-container');

                    // Description input (single line)
                    const descriptionInput = document.createElement('input');
                    descriptionInput.type = 'text';
                    descriptionInput.value = templateTemp.description;
                    descriptionInput.placeholder = 'Description';
                    descriptionInput.classList.add('advanced-input', 'single-line');

                    // Bind input (single line)
                    const bindInput = document.createElement('input');
                    bindInput.type = 'text';
                    bindInput.value = templateTemp.bind;
                    bindInput.placeholder = 'Bind Key';
                    bindInput.classList.add('advanced-input', 'single-line');

                    // Command input (multi-line)
                    const commandInput = document.createElement('textarea');
                    commandInput.value = templateTemp.command;
                    commandInput.placeholder = 'Command';
                    commandInput.classList.add('advanced-input', 'multi-line');

                    // Tag input (single line)
                    const tagInput = document.createElement('input');
                    tagInput.type = 'text';
                    tagInput.value = templateTemp.tag.join(', ');
                    tagInput.placeholder = 'Tag (comma-separated)';
                    tagInput.classList.add('advanced-input', 'single-line');

                    // Debug
                    // if (!templateTemp) {
                    //     console.log("templateTemp is null as tempIndex:" + templateTempIndex + " originalIndex:" + originalIndex);
                    // }
                    // if (!Array.isArray(templateTemp.tag)) {
                    //     console.log("templateTemp.tag is not an array as tempIndex:" + templateTempIndex + " originalIndex:" + originalIndex);
                    // }

                    // Add change event listeners to update the templates
                    const updateTemplates = () => {
                        templates[originalIndex].description = descriptionInput.value;
                        templates[originalIndex].bind = bindInput.value;
                        templates[originalIndex].command = commandInput.value;
                        templates[originalIndex].tag = tagInput.value.split(/[,ï¼Œ]/).map(tag => tag.trim()).filter(tag => tag);
                    };

                    descriptionInput.addEventListener('change', updateTemplates);
                    bindInput.addEventListener('change', updateTemplates);
                    commandInput.addEventListener('change', updateTemplates);
                    tagInput.addEventListener('change', updateTemplates);

                    // Create label for each input
                    const createLabel = (text) => {
                        const label = document.createElement('label');
                        label.textContent = text;
                        label.classList.add('advanced-label');
                        return label;
                    };

                    // Assemble the item
                    const fields = [
                        { label: 'Description:', input: descriptionInput },
                        { label: 'Bind:', input: bindInput },
                        { label: 'Command:', input: commandInput },
                        { label: 'Tag:', input: tagInput }
                    ];

                    fields.forEach(field => {
                        const fieldWrapper = document.createElement('div');
                        fieldWrapper.classList.add('advanced-field-wrapper');

                        const label = createLabel(field.label);
                        fieldWrapper.appendChild(label);
                        fieldWrapper.appendChild(field.input);

                        editContainer.appendChild(fieldWrapper);
                    });

                    templateItem.appendChild(editContainer);
                    templateListElement.appendChild(templateItem);
                });
            }
        }

        // ä¿®æ”¹æ‹–æ”¾äº‹ä»¶å¤„ç†é€»è¾‘
        let draggedItem = null;

        function dragStart(e) {
            draggedItem = e.target.closest('.draggable');
            e.dataTransfer.setData('text/plain', draggedItem.id);
            e.dataTransfer.effectAllowed = 'move'; // å…è®¸æ‹–æ”¾æ•ˆæœ

            // draggedItem.classList.add('drag-item');
        }

        function dragOver(e) {
            e.preventDefault();
            return false;
        }

        function dragEnter(e) {
            const target = e.target.closest('.draggable');
            if (target && target !== draggedItem) {

                target.classList.add('drag-over');

                /*                 // è·å–æ‹–åŠ¨å…ƒç´ å’Œç›®æ ‡å…ƒç´ çš„ç´¢å¼•
                                const draggedIndex = Array.from(target.parentNode.children).indexOf(draggedItem);
                                const targetIndex = Array.from(target.parentNode.children).indexOf(target);
                
                                // æ·»åŠ CSSç±»è¿›è¡ŒåŠ¨ç”»
                                target.classList.add('drag-over');
                
                                // æ ¹æ®ç´¢å¼•åˆ¤æ–­ç§»åŠ¨æ–¹å‘
                                if (draggedIndex < targetIndex) {
                                    // å‘ä¸‹ç§»åŠ¨åŠ¨ç”»
                                    target.classList.add('drag-move-up');
                                } else if (draggedIndex > targetIndex) {
                                    // å‘ä¸Šç§»åŠ¨åŠ¨ç”» 
                                    target.classList.add('drag-move-down');
                                } */
            }
        }

        function dragLeave(e) {
            const target = e.target.closest('.draggable');
            if (target) {

                target.classList.remove('drag-over', 'drag-move-down', 'drag-move-up');

                /*                 // 20241201-æ·»åŠ ä½ç§»æ•ˆæœ
                                // å»¶è¿Ÿç§»é™¤åŠ¨ç”»ç±»ï¼Œä¿æŒè¿‡æ¸¡æ•ˆæœ
                                setTimeout(() => {
                                    target.classList.remove('drag-over', 'drag-move-down', 'drag-move-up');
                                }, 300); // ä¸åŠ¨ç”»æ—¶é—´ä¸€è‡´ */

            }
        }

        function trashBinDragOver(e) {
            e.preventDefault();
            trashBin.classList.add('drag-over');
        }

        function trashBinDragLeave(e) {
            trashBin.classList.remove('drag-over');
        }

        function trashBinDrop(e) {
            e.preventDefault();
            trashBin.classList.remove('drag-over');

            // é€šè¿‡ id è·å–è¢«æ‹–åŠ¨çš„å…ƒç´ 
            const draggedId = e.dataTransfer.getData('text/plain');
            const draggedElement = document.getElementById(draggedId);

            if (draggedElement) {
                // è·å–è¢«æ‹–åŠ¨å…ƒç´ çš„ç´¢å¼•
                const originalIndex = parseInt(draggedElement.dataset.originalIndex, 10); // è·å–åŸå§‹ç´¢å¼•

                // æ˜¾ç¤ºåˆ é™¤æç¤º
                showPopup("å·²ç§»é™¤" + bindings[originalIndex].description, 'popupContainer');

                // ä» bindings æ•°ç»„ä¸­ç§»é™¤å¯¹åº”çš„ç»‘å®š
                bindings.splice(originalIndex, 1);

                // é‡æ–°æ¸²æŸ“ç»‘å®šåˆ—è¡¨
                renderBindings();
            }

            // æ¸…é™¤æ‹–æ”¾çŠ¶æ€
            draggedItem = null;
        }

        // Modify the existing script to add copy functionality
        function copyCopyBinDragOver(e) {
            e.preventDefault();
            copyBin.classList.add('drag-over');
        }

        function copyCopyBinDragLeave(e) {
            copyBin.classList.remove('drag-over');
        }

        function copyCopyBinDrop(e) {
            e.preventDefault();
            copyBin.classList.remove('drag-over');

            // Get the dragged item's ID
            const draggedId = e.dataTransfer.getData('text/plain');
            const draggedElement = document.getElementById(draggedId);

            if (draggedElement) {
                const originalIndex = parseInt(draggedElement.dataset.originalIndex, 10); // è·å–åŸå§‹ç´¢å¼•

                // Create a deep copy of the binding at the dragged index
                const copiedBinding = JSON.parse(JSON.stringify(bindings[originalIndex]));

                // Insert the copied binding at the dragged index
                bindings.splice(originalIndex, 0, copiedBinding);

                // Re-render the bindings list
                renderBindings();

                // Show a popup to confirm copying
                showPopup("å·²å¤åˆ¶" + bindings[originalIndex].description, 'popupContainer');
            }

            // Clear drag state
            draggedItem = null;
        }

        function clipBinDragOver(e) {
            e.preventDefault();
            clipBin.classList.add('drag-over');
        }

        function clipBinDragLeave(e) {
            clipBin.classList.remove('drag-over');
        }

        function clipBinDrop(e) {
            e.preventDefault();
            clipBin.classList.remove('drag-over');

            // é€šè¿‡ id è·å–è¢«æ‹–åŠ¨çš„å…ƒç´ 
            const draggedId = e.dataTransfer.getData('text/plain');
            const draggedElement = document.getElementById(draggedId);

            if (draggedElement) {
                const originalIndex = parseInt(draggedElement.dataset.originalIndex, 10); // è·å–åŸå§‹ç´¢å¼•

                // å¤åˆ¶åˆ°å‰ªåˆ‡æ¿
                const copyText = extractAsCmd(bindings[originalIndex]);
                if (copyText === "") {
                    showPopup("æ­¤è®¾ç½®çš„é”®ä½ä¸ºç©ºï¼Œæ— æ³•å¤åˆ¶åˆ°å‰ªåˆ‡æ¿", 'popupContainer');
                    return;
                }
                navigator.clipboard.writeText(copyText)
                    .then(() => {
                        showPopup("ç»‘å®š" + bindings[originalIndex].description + "å·²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿", 'popupContainer');
                        console.log("ç»‘å®š[" + copyText + "]å·²å¤åˆ¶åˆ°å‰ªåˆ‡æ¿");
                    })
                    .catch(err => {
                        showPopup("å¤åˆ¶åˆ°å‰ªåˆ‡æ¿å¤±è´¥" + err, 'popupContainer');
                    });
            }

            // æ¸…é™¤æ‹–æ”¾çŠ¶æ€
            draggedItem = null;
        }

        function drop(e) {
            e.preventDefault();
            const target = e.target.closest('.draggable');

            // ç§»é™¤æ‰€æœ‰æ‹–æ”¾æ ·å¼
            document.querySelectorAll('.draggable').forEach(item => {
                item.classList.remove('drag-over');
            });

            if (target && target !== draggedItem) {
                // è·å–æ‹–åŠ¨å’Œç›®æ ‡å…ƒç´ çš„ç´¢å¼•
                const draggedIndex = parseInt(draggedItem.dataset.originalIndex, 10);
                const targetIndex = parseInt(target.dataset.originalIndex, 10);

                // ä»åŸä½ç½®ç§»é™¤ç»‘å®š
                const removedBinding = bindings.splice(draggedIndex, 1)[0];

                // åœ¨æ–°ä½ç½®æ’å…¥ç»‘å®š
                bindings.splice(targetIndex, 0, removedBinding);

                // é‡æ–°æ¸²æŸ“ç»‘å®šåˆ—è¡¨
                renderBindings();
            }

            // æ¸…é™¤æ‹–æ”¾çŠ¶æ€
            draggedItem = null;
        }

        // ç¡®ä¿æ‰€æœ‰æ‹–æ”¾äº‹ä»¶è¢«æ­£ç¡®ç»‘å®š
        function attachDragEvents() {
            const draggableItems = document.querySelectorAll('.draggable');
            draggableItems.forEach(item => {
                item.addEventListener('dragstart', dragStart);
                item.addEventListener('dragover', dragOver);
                item.addEventListener('drop', drop);
                item.addEventListener('dragenter', dragEnter);
                item.addEventListener('dragleave', dragLeave);
            });
        }

        dropArea.addEventListener('dragover', (event) => {
            event.preventDefault();
        });

        dropArea.addEventListener('drop', (event) => {
            event.preventDefault();
            const file = event.dataTransfer.files[0];
            if (file) {
                handleFile(file);
            }
        });

        dropArea.addEventListener('click', () => {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.cfg';

            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    handleFile(file);
                }
            });

            fileInput.click();
        });

        function handleFile(file) {
            const reader = new FileReader();

            reader.onload = function (event) {
                const content = event.target.result;

                if (content.startsWith("//poyakong.cfg")) {
                    dropArea.textContent = 'æ–‡ä»¶è½½å…¥ä¸­...';
                    setTimeout(() => {
                        currentFile = file;
                        dropArea.style.display = 'none';
                        removeHiddens();
                        loadBindingsFromFile(content);
                        showPopup("æ¬¢è¿ä½¿ç”¨CS2æŒ‰é”®åŠ©æ‰‹ï¼" + new Date().toLocaleString(), 'popupContainer'); // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ + å½“å‰çš„æ—¶é—´
                    }, 500);
                } else {
                    dropArea.textContent = 'ä¼¼ä¹æ˜¯ä¸å—æ”¯æŒçš„æ ¼å¼ è¯·ç¡®ä¿è½½å…¥poyakong.cfgæ ¼å¼çš„æ–‡ä»¶';
                }
            };

            reader.onerror = function () {
                dropArea.textContent = 'æ— æ³•è¯»å–æ–‡ä»¶ è¯·ç¡®ä¿è½½å…¥æ­£ç¡®çš„æ–‡æœ¬æ ¼å¼çš„poyakong.cfgæ–‡ä»¶';
            };

            reader.readAsText(file, 'UTF-8');
        }

        function importFile() {
            // åˆ›å»ºä¸€ä¸ªéšè—çš„æ–‡ä»¶è¾“å…¥å…ƒç´ 
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.cfg'; // è®¾ç½®æ”¯æŒçš„æ–‡ä»¶ç±»å‹

            // ç›‘å¬æ–‡ä»¶é€‰æ‹©äº‹ä»¶
            fileInput.addEventListener('change', (event) => {
                const file = event.target.files[0]; // è·å–ç”¨æˆ·é€‰æ‹©çš„æ–‡ä»¶
                if (file) {
                    // è¯»å–æ–‡ä»¶å†…å®¹
                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const content = e.target.result; // è·å–æ–‡ä»¶å†…å®¹
                        // å¤„ç†æ–‡ä»¶å†…å®¹ï¼ˆä¾‹å¦‚ï¼Œè§£æç»‘å®šæ•°æ®ï¼‰
                        // æ ¹æ®æ–‡ä»¶å†…å®¹è¿›è¡Œå¤„ç†ï¼ˆä¾‹å¦‚è§£æ.cfgæ–‡ä»¶ï¼‰
                        console.log('æ–‡ä»¶å†…å®¹:', content);

                        // ç¤ºä¾‹ï¼šå‡è®¾æ–‡ä»¶å†…å®¹ä¸ºç‰¹å®šæ ¼å¼ï¼Œå¯ä»¥è¿›è¡Œè§£æå¹¶å¤„ç†
                        // å¦‚æœæ–‡ä»¶æ˜¯æ ‡å‡†çš„ ".cfg" æ ¼å¼ï¼Œå¯ä»¥è§£æå†…å®¹å¹¶è°ƒç”¨ç›¸åº”çš„å‡½æ•°
                        if (content.startsWith("//poyakong.cfg")) {
                            // è§£ææ–‡ä»¶å†…å®¹å¹¶åŠ è½½ç»‘å®š
                            loadBindingsFromFile(content);
                        } else {
                            showPopup("ä¼¼ä¹æ˜¯ä¸å—æ”¯æŒçš„æ ¼å¼ è¯·ç¡®ä¿è½½å…¥poyakong.cfgæ ¼å¼çš„æ–‡ä»¶", 'popupContainer');
                            console.error("ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼");
                        }
                    };

                    reader.onerror = function () {
                        console.error('æ–‡ä»¶è¯»å–å¤±è´¥');
                    };

                    reader.readAsText(file); // ä»¥æ–‡æœ¬å½¢å¼è¯»å–æ–‡ä»¶
                } else {
                    console.error('æœªé€‰æ‹©æ–‡ä»¶');
                }
            });

            // è§¦å‘æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
            fileInput.click();
        }

        // ä¿å­˜æŒ‰é’® - äº‹ä»¶ç›‘å¬
        addEventListener('click', (event) => {
            if (event.target === exportSettingsButton) {
                exportSettings();
            }
        });

        // å¯¼å…¥æŒ‰é’® - äº‹ä»¶ç›‘å¬
        addEventListener('click', (event) => {
            if (event.target === importSettingsButton) {
                importFile();
            }
        });

        // å‰ªåˆ‡æ¿æŒ‰é’® - äº‹ä»¶ç›‘å¬
        addEventListener('click', (event) => {
            if (event.target === clipboardButton) {
                const copyText = extractAsCmd(bindings[0]);
                // if copyText is empty, show a popup fail message
                if (copyText === "") {
                    showPopup("æ­¤è®¾ç½®çš„é”®ä½ä¸ºç©ºï¼Œæ— æ³•å¤åˆ¶åˆ°å‰ªåˆ‡æ¿", 'popupContainer');
                    return;
                }
                navigator.clipboard.writeText(copyText)
                    .then(() => {
                        showPopup("ç»‘å®šå·²å¤åˆ¶é¦–æ¡æŒ‡ä»¤" + bindings[0].description + "åˆ°å‰ªåˆ‡æ¿", 'popupContainer');
                    })
                    .catch(err => {
                        showPopup("å¤åˆ¶åˆ°å‰ªåˆ‡æ¿å¤±è´¥" + err, 'popupContainer');
                    });
            }
        });

        // å…³äºæŒ‰é’® - äº‹ä»¶ç›‘å¬
        addEventListener('click', (event) => {
            if (event.target === Info) {
                showPopup("ä½œè€…: ç ´äºšç©º-Yakong-P æ„ç­‘ç‰ˆæœ¬: 2024-12-14\n", 'popupContainer');
                secretCounter++;
                if (secretCounter >= 5) {
                    secretTrigger();
                }
            }
        });

        // å½©è›‹è§¦å‘
        function secretTrigger() {
            advancedModeButton.classList.remove('hidden');
            Info.classList.add('hidden');
            showPopup("ä½ å‘ç°äº†ä¸€ä¸ªç§˜å¯†æŒ‰é’®ï¼Œç‚¹å‡»å®ƒå¯ä»¥å¼€å¯è¿›é˜¶æ¨¡å¼ï¼", 'popupContainer');
            showPopup("ä½ å‘ç°äº†ä¸€ä¸ªç§˜å¯†æŒ‰é’®ï¼Œç‚¹å‡»å®ƒå¯ä»¥å¼€å¯è¿›é˜¶æ¨¡å¼ï¼", 'popupContainer');
            showPopup("ä½ å‘ç°äº†ä¸€ä¸ªç§˜å¯†æŒ‰é’®ï¼Œç‚¹å‡»å®ƒå¯ä»¥å¼€å¯è¿›é˜¶æ¨¡å¼ï¼", 'popupContainer');
            showPopup("ä½ å‘ç°äº†ä¸€ä¸ªç§˜å¯†æŒ‰é’®ï¼Œç‚¹å‡»å®ƒå¯ä»¥å¼€å¯è¿›é˜¶æ¨¡å¼ï¼", 'popupContainer');
            showPopup("ä½ å‘ç°äº†ä¸€ä¸ªç§˜å¯†æŒ‰é’®ï¼Œç‚¹å‡»å®ƒå¯ä»¥å¼€å¯è¿›é˜¶æ¨¡å¼ï¼", 'popupContainer');
            showPopup("ä½ å‘ç°äº†ä¸€ä¸ªç§˜å¯†æŒ‰é’®ï¼Œç‚¹å‡»å®ƒå¯ä»¥å¼€å¯è¿›é˜¶æ¨¡å¼ï¼", 'popupContainer');
        }

        // è¿›é˜¶æ¨¡å¼æŒ‰é’® - åˆ‡æ¢
        function toggleAdvancedMode() {
            advancedMode = !advancedMode;
            checkAdvancedMode();
            renderBindings();
            renderTemplates();
        }

        // è¿›é˜¶æ¨¡å¼æŒ‰é’® - äº‹ä»¶ç›‘å¬
        addEventListener('click', (event) => {
            if (event.target === advancedModeButton) {
                toggleAdvancedMode();
            }
        });

        // 20241214-è‡ªåŠ¨å¤åˆ¶æ¨¡å¼ - äº‹ä»¶ç›‘å¬
        addEventListener('click', (event) => {
            if (event.target === autoClipboardButton) {
                autoClipboardMode = !autoClipboardMode;    // åˆ‡æ¢è‡ªåŠ¨å¤åˆ¶æ¨¡å¼
                if (!autoClipboardMode) {
                    autoClipboardButton.classList.add('off');
                    showPopup("è‡ªåŠ¨å¤åˆ¶æŒ‡ä»¤åŠŸèƒ½å·²å…³é—­", 'popupContainer');
                } else {
                    autoClipboardButton.classList.remove('off');
                    showPopup("è‡ªåŠ¨å¤åˆ¶æŒ‡ä»¤åŠŸèƒ½å·²å¼€å¯", 'popupContainer');
                }
            }
        });

        // åˆæ¬¡å¯åŠ¨æ—¶çš„é¡µé¢åˆ‡æ¢
        function removeHiddens() {
            appTitle.classList.remove('hidden'); // æ˜¾ç¤ºæ ‡é¢˜
            bindingListElement.classList.remove('hidden'); // æ˜¾ç¤ºç»‘å®šåˆ—è¡¨
            templateListElement.classList.remove('hidden'); //   æ˜¾ç¤ºæ¨¡æ¿åˆ—è¡¨
            addBindingButton.classList.remove('hidden'); // æ˜¾ç¤ºæ·»åŠ ç»‘å®šæŒ‰é’®
            // advancedModeButton.classList.remove('hidden'); // æ˜¾ç¤ºè¿›é˜¶æ¨¡å¼æŒ‰é’®
            // autoSaveButton.classList.remove('hidden'); //     æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜æŒ‰é’®
            exportSettingsButton.classList.remove('hidden'); // æ˜¾ç¤ºå¯¼å‡ºè®¾ç½®æŒ‰é’®
            importSettingsButton.classList.remove('hidden'); // æ˜¾ç¤ºå¯¼å…¥è®¾ç½®æŒ‰é’®
            importSettingsButton.classList.remove('advanced'); // 20241202-å¼€æ”¾å¯¼å…¥è®¾ç½®æŒ‰é’®ç»™ç”¨æˆ·
            autoClipboardButton.classList.remove('hidden'); // 20241214-å¯ç”¨è‡ªåŠ¨å¤åˆ¶æŒ‡ä»¤åŠŸèƒ½
            // importSettingsButton.classList.add('warm'); //  æ˜¾ç¤ºå¯¼å…¥è®¾ç½®æŒ‰é’®é¢œè‰²
            searchContainer.classList.remove('hidden'); // æ˜¾ç¤ºæœç´¢æ¡†
            trashBin.classList.remove('hidden'); // æ˜¾ç¤ºåƒåœ¾æ¡¶
            copyBin.classList.remove('hidden'); // æ˜¾ç¤ºå¤åˆ¶æ¡¶
            // clipboardButton.classList.remove('hidden'); // æ˜¾ç¤ºå¤åˆ¶æŒ‰é’®
            clipBin.classList.remove('hidden'); // æ˜¾ç¤ºå‰ªåˆ‡æ¡¶
            Info.classList.remove('hidden'); // æ˜¾ç¤ºå…³äºæŒ‰é’®
            // checkAdvancedMode(); // æ£€æŸ¥æ˜¯å¦å¼€å¯è¿›é˜¶æ¨¡å¼
            if (advancedMode) {
                addBindingButton.classList.remove('advanced');
            } else {
                addBindingButton.classList.add('advanced');
            }
            // checkAutoSaveMode();
            if (!autoSaveMode) {
                autoSaveButton.classList.add('off');
            }
        }

        // æ˜¾ç¤º - æŒ‰é’®æ§åˆ¶ - è¿›é˜¶æ¨¡å¼
        function checkAdvancedMode() {
            if (advancedMode) {
                addBindingButton.classList.remove('advanced');
                // importSettingsButton.classList.remove('advanced');
                advancedModeButton.classList.add('warm');
            } else {
                addBindingButton.classList.add('advanced');
                // importSettingsButton.classList.add('advanced');
                advancedModeButton.classList.remove('warm');
            }
        }

        // æ˜¾ç¤º - æŒ‰é’®æ§åˆ¶ - è‡ªåŠ¨ä¿å­˜
        function toggleAutoSave() {
            autoSaveMode = !autoSaveMode;    // åˆ‡æ¢è‡ªåŠ¨ä¿å­˜æ¨¡å¼
            if (!autoSaveMode) {
                autoSaveButton.classList.add('off');
                showPopup("è‡ªåŠ¨å¯¼å‡ºå·²å…³é—­", 'popupContainer');
            } else {
                autoSaveButton.classList.remove('off');
                showPopup("è‡ªåŠ¨å¯¼å‡ºå·²å¼€å¯", 'popupContainer');
                exportSettings();
            }
        }

        // åŠŸèƒ½ - æŒ‰é’®æ§åˆ¶ - è‡ªåŠ¨ä¿å­˜
        addEventListener('click', (event) => {
            if (event.target === autoSaveButton) {
                toggleAutoSave();
            }
        });

        // æ–‡ä»¶å¯¼å…¥
        function loadBindingsFromFile(passContent) {
            // Debug å¯¼å…¥æ—¶æ¸…æ´—æ–‡æœ¬å†…å®¹ (\n -> \r\n)
            // const content = passContent
            //     .replace(/\r\n/g, '\n') // å…ˆå¤„ç† CRLF
            //     .replace(/\r/g, '\n') // å¤„ç†è€å¼ Mac é£æ ¼çš„ CR
            //     .replace(/\n/g, '\r\n'); // ç»Ÿä¸€æ¢æˆ Windows é£æ ¼çš„ CRLF

            // Debug å¯¼å…¥æ—¶æ¸…æ´—æ–‡æœ¬å†…å®¹ (\r\n -> \n)
            const content = passContent
                .replace(/\r\n/g, '\n') // å…ˆå¤„ç† CRLF
                .replace(/\r/g, '\n') // å¤„ç†è€å¼ Mac é£æ ¼çš„ CR

            // Find a line call "//template builder"
            const templateBuilderIndex = content.indexOf('//template builder');
            if (templateBuilderIndex >= 0) {
                let lines = content.substring(templateBuilderIndex).split('\n'); // Skip "//template builder" at the start
                // æ¯å››è¡Œè§£æä¸€ä¸ªç»‘å®š, all start with "//"
                if (lines[1] && lines[1].startsWith('//')) {
                    lines = lines.filter(line => line.startsWith('//')); // è¿‡æ»¤å‡ºä»¥â€œ//â€å¼€å¤´çš„è¡Œ

                    for (let i = 1; i < lines.length; i += 4) {
                        // æ£€æŸ¥æ˜¯å¦æœ‰è¶³å¤Ÿçš„è¡Œ
                        if (i + 3 >= lines.length) {
                            console.warn("å¿½ç•¥ä¸å®Œæ•´çš„ç»‘å®šä¿¡æ¯:", lines.slice(i));
                            break;
                        }

                        // æå–å››è¡Œå¯¹åº”çš„å­—æ®µ
                        const description = lines[i].slice(2).trim(); // å»æ‰å‰ç¼€ "//"
                        const bind = lines[i + 1].slice(2).trim(); // ç¬¬äºŒè¡Œä½œä¸º bind
                        const command = lines[i + 2].slice(2).trim(); // ç¬¬ä¸‰è¡Œä½œä¸º command
                        const tag = lines[i + 3].slice(2).trim().split(/[,ï¼Œ]/).map(tag => tag.trim()).filter(tag => tag);; // ç¬¬å››è¡Œä½œä¸º tag

                        // åˆ›å»ºç»‘å®šå¯¹è±¡å¹¶æ·»åŠ åˆ°æ•°ç»„
                        templates.push({ description, bind, command, tag });
                    }
                    renderTemplates();  // æ¸²æŸ“æ¨¡æ¿æ•°æ®
                }
            }

            // Find a line call "//json-bindings"
            let jsonIndex = content.indexOf('//json-bindings');
            if (jsonIndex >= 0) {
                const lines = content.substring(jsonIndex).split('\n'); //.map(line => line.trim()); //å†—ä½™ä¿é™© // skin "//json-bindings"
                // è·³è¿‡ "//"
                if (lines[1] && lines[1].startsWith('//')) {
                    const jsonStr = lines[1].substring(2).trim(); // Skip "//" at the start
                    // å¦‚æœå†…å®¹ä¸æ˜¯ç©ºçš„
                    if (jsonStr) {
                        try {
                            // è§£æ JSON å­—ç¬¦ä¸²
                            const json = JSON.parse(jsonStr);
                            // å°†è§£æçš„ JSON append to the existing bindings
                            bindings.push(...json);
                            renderBindings();  // æ¸²æŸ“ç»‘å®šæ•°æ®
                        } catch (e) {
                            showPopup("ä¸æ˜åŸå› å¯¼è‡´json-bindingsè§£æå¤±è´¥" + e, 'popupContainer');
                            console.error("JSON è§£æå¤±è´¥:" + e, e);
                        }
                    }
                }
            }

            // Find a line call "//json-templates"
            jsonIndex = content.indexOf('//json-templates');
            if (jsonIndex >= 0) {
                const lines = content.substring(jsonIndex).split('\n'); //.map(line => line.trim()); //å†—ä½™ä¿é™© // skin "//json-templates"
                // è·³è¿‡ "//"
                if (lines[1] && lines[1].startsWith('//')) {
                    const jsonStr = lines[1].substring(2).trim(); // Skip "//" at the start
                    // å¦‚æœå†…å®¹ä¸æ˜¯ç©ºçš„
                    if (jsonStr) {
                        try {
                            // è§£æ JSON å­—ç¬¦ä¸²
                            const json = JSON.parse(jsonStr);
                            // å°†è§£æçš„ JSON append to the existing templates
                            templates.push(...json);
                            renderTemplates();  // æ¸²æŸ“ç»‘å®šæ•°æ®
                        } catch (e) {
                            showPopup("ä¸æ˜åŸå› å¯¼è‡´json-templatesè§£æå¤±è´¥" + e, 'popupContainer');
                            console.error("JSON è§£æå¤±è´¥:" + e, e);
                        }
                    }
                }
            }
        }

        // æ–‡ä»¶å¯¼å‡º
        function exportSettings() {
            try {
                // Construct the content string as three parts:
                // 1. the first line "//poyakong.cfg"
                // 2. for each binding, extractAsEcho() + extractAsCmd() + '\n'
                // 3. the JSON string for the bindings array
                const content = `//poyakong.cfg\n` +
                    `//` + appTitle.textContent + '\n' +
                    `//ä½œè€…: ç ´äºšç©º-Yakong-P\n` +
                    `//æ–‡ä»¶æ„ç­‘: ` + new Date().toLocaleString() + '\n' +
                    '\n' +
                    '\n' +
                    `//ä½¿ç”¨æ–¹æ³•ï¼š\n` +
                    `//1ã€å°†æœ¬æ–‡ä»¶æ”¾ç½®äºCounterStrike: Global Offesive/game/csgo/cfgæ–‡ä»¶å¤¹ä¸­\n` +
                    `//2ã€æ‰“å¼€æ¸¸æˆ\n` +
                    `//3ã€åœ¨CS2è®¾ç½®é‡Œï¼Œå¯ç”¨æ§åˆ¶å°\n` +
                    `//4ã€åœ¨æ§åˆ¶å°é‡Œï¼Œè¾“å…¥exec poyakong.cfgï¼Œç„¶åå›è½¦ç¡®è®¤\n` +
                    `//5ã€å¦‚æœå¯¼å…¥æˆåŠŸï¼Œåˆ™ä¼šæ˜¾ç¤ºä¸€å †çš„ç»‘å®šçš„ä¿¡æ¯\n` +
                    `//6ã€å¦‚æœå¯¼å…¥å¤±è´¥ï¼Œåˆ™ä¼šäº§ç”Ÿä¸€æ¡æ‰§è¡Œå¤±è´¥çš„ä¿¡æ¯ï¼š[InputService] exec: couldn't exec '{*}cfg/xxx.cfg', unable to read file\n` +
                    '\n' +
                    '\n' +
                    // å¯¼å‡ºç»‘å®š
                    bindings.map(binding => {
                        // æ£€æŸ¥ binding.bind æ˜¯å¦ä¸ºç©ºï¼Œç©ºåˆ™è·³è¿‡
                        if (!binding.bind) {
                            return '';
                        }
                        return `//` + binding.description + '\n' + extractAsCmd(binding) + '\n';
                    }).join('') +
                    '\n' +
                    '\n' +
                    // ç”Ÿæˆecho
                    bindings.map(binding => {
                        // æ£€æŸ¥ binding.templates æ˜¯å¦ä¸ºç©ºï¼Œç©ºåˆ™è·³è¿‡
                        if (!binding.bind) {
                            return '';
                        }
                        return extractAsEcho(binding);
                    }).join('') +
                    '\n' +
                    '\n' +
                    `//json-bindings\n` +
                    `//` + extractAsJson(bindings); //+
                // '\n' +
                // '\n' +
                // `//json-templates\n` +
                // `//` + extractAsJson(templates);

                // Create a file and write the content to it with name poyakong.cfg
                const file = new File([content], 'poyakong.cfg', { type: 'text/plain' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(file);
                link.download = 'poyakong.cfg';

                // Trigger download
                link.click();

                // Show success popup
                showPopup("ä¿å­˜æˆåŠŸï¼Œè¯·å°†.cfgæ–‡ä»¶æ”¾ç½®åˆ°CounterStrike: Global Offesive/game/csgo/cfgæ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶åœ¨æ¸¸æˆå†…æ§åˆ¶å°è¾“å…¥exec poyakong", 'popupContainer');
            } catch (error) {
                // Log the error (for debugging purposes)
                console.error("å¯¼å‡ºæ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯:", error);

                // Show error popup
                showPopup("ä¿å­˜å¤±è´¥ï¼Œäº§ç”Ÿäº†é¢„æ–™ä¹‹å¤–çš„é”™è¯¯ " + errer, 'popupContainer');
            }
        }

        // Cmd
        function extractAsCmd(binding) {
            // check if the bind is empty
            if (!binding.bind) {
                return "";
            }
            // extract the bind and command
            const bind = binding.bind;
            const command = binding.command;
            // replace the "[key]" in the command with the bind
            let cmd = command.replace(/\[key\]/g, bind);
            // check every \n if they missing ; as ;\n
            cmd = cmd
                .split('\n')
                .map(line => (line.endsWith(';') ? line : line + ';'))
                .join('\n');

            // return the cmd
            return cmd;
        }

        // echo
        function extractAsEcho(binding) {
            // check if the bind is empty
            if (!binding.bind) {
                return "";
            }
            // extract the description and keybind
            const description = binding.description;
            const bind = binding.bind;
            // return the echo
            return `echo \"\[${bind}\]ç»‘å®šä¸º${description}\"\n`;
        }

        // json
        function extractAsJson(bindings) {
            return JSON.stringify(bindings, null, 0);
        }


        // è‡ªåŠ¨è°ƒæ•´ textarea é«˜åº¦
        function autoResizeTextarea() {
            const textarea = document.querySelectorAll('textarea');
            textarea.forEach((el) => {
                el.addEventListener('input', () => {
                    el.style.height = 'auto';  // é‡ç½®é«˜åº¦
                    el.style.height = el.scrollHeight - 15 + 'px';  // è®¾ç½®é«˜åº¦ä¸ºå†…å®¹çš„å®é™…é«˜åº¦
                });
            });
        }

        // åˆå§‹åŒ–è‡ªåŠ¨è°ƒæ•´é«˜åº¦çš„åŠŸèƒ½
        autoResizeTextarea();

        function setupKeyDetector() {
            return new Promise((resolve) => {
                // Create a full-screen overlay for key detection
                const keyDetectorOverlay = document.createElement('div');
                keyDetectorOverlay.classList.add('keyDetectorOverlay');

                keyDetectorOverlay.textContent = 'è¯·è¾“å…¥æŒ‰é”®\næˆ–æŒ‰ESCé€€å‡º';

                const specialKeyMappings = {
                    // Numpad keys
                    'NumpadAdd': 'kp_plus',
                    'NumpadSubtract': 'kp_minus',
                    'NumpadMultiply': 'kp_multiply',
                    'NumpadDivide': 'kp_divide',
                    'NumpadEnter': 'kp_enter',
                    'NumpadDecimal': 'kp_del',

                    // Modifier keys
                    'ControlRight': 'rCtrl',
                    'ShiftRight': 'rShift',
                    'AltRight': 'rAlt',

                    // Additional special keys
                    'Tab': 'Tab',
                    'CapsLock': 'Capslock',
                    'Insert': 'Ins',
                    'Delete': 'Del',
                    'Home': 'Home',
                    'End': 'End',
                    'PageUp': 'Pgup',
                    'PageDown': 'Pgdn',
                    'ScrollLock': 'Scrolllock',
                    'Pause': 'Pause',
                    'Backspace': 'Backspace',
                    'Semicolon': 'Semicolon'

                    // 'MetaRight': 'rwin'
                };

                // Numpad digit mapping
                for (let i = 0; i <= 9; i++) {
                    specialKeyMappings[`Numpad${i}`] = `kp_${i}`;
                }

                // Add key event listener
                const keyHandler = (event) => {
                    // Prevent default to stop propagation
                    event.preventDefault();

                    // Check for ESC key to exit
                    if (event.key === 'Escape') {
                        document.body.removeChild(keyDetectorOverlay);
                        document.removeEventListener('keydown', keyHandler);
                        resolve(null); // è¿”å› null è¡¨ç¤ºå–æ¶ˆ
                        return;
                    }

                    // Check for modifier keys first
                    if (['Control', 'Shift', 'Alt', 'CapsLock', 'Tab'].includes(event.key)) {
                        let modifierKey = '';
                        if (event.ctrlKey) modifierKey = event.location === event.DOM_KEY_LOCATION_RIGHT ? 'rCtrl' : 'Ctrl';
                        if (event.shiftKey) modifierKey = event.location === event.DOM_KEY_LOCATION_RIGHT ? 'rShift' : 'Shift';
                        if (event.altKey) modifierKey = event.location === event.DOM_KEY_LOCATION_RIGHT ? 'rAlt' : 'Alt';

                        // Check for other special keys
                        const specialKeyMap = {
                            'CapsLock': 'Capslock',
                            'Tab': 'Tab'
                        };

                        modifierKey = modifierKey || specialKeyMap[event.key];

                        if (modifierKey) {
                            // Remove the overlay
                            cleanup();
                            resolve(modifierKey);
                            return;
                        }
                    }

                    // Check for mappable special keys
                    const specialKey = specialKeyMappings[event.code] || specialKeyMappings[event.key];

                    // Determine the key to use
                    const bindKey = specialKey ||
                        (event.key.length === 1
                            ? event.key.toUpperCase()
                            : (['F1', 'F2', 'F3', 'F4', 'F5', 'F6', 'F7', 'F8', 'F9', 'F10', 'F11', 'F12'].includes(event.key) ? event.key : null));

                    if (bindKey) {

                        // Remove the overlay
                        cleanup();
                        //
                        resolve(bindKey);
                        return;
                    }
                };

                const mouseHandler = (event) => {
                    event.preventDefault();

                    let mouseKey;
                    switch (event.button) {
                        case 0: mouseKey = 'mouse1'; break;
                        case 1: mouseKey = 'mouse3'; break;
                        case 2: mouseKey = 'mouse2'; break;
                        case 3: mouseKey = 'mouse4'; break; // Side button 1
                        case 4: mouseKey = 'mouse5'; break; // Side button 2
                    }

                    if (mouseKey) {
                        cleanup();
                        resolve(mouseKey);
                        return;
                    }
                };

                const wheelHandler = (event) => {
                    event.preventDefault();

                    const direction = event.deltaY < 0 ? 'mwheelup' : 'mwheeldown';
                    cleanup();
                    resolve(direction);
                };

                const cleanup = () => {
                    document.body.removeChild(keyDetectorOverlay);
                    document.removeEventListener('keydown', keyHandler);
                    document.removeEventListener('mousedown', mouseHandler);
                    document.removeEventListener('wheel', wheelHandler);
                };

                // Add event listener and append to body
                document.addEventListener('keydown', keyHandler);
                document.addEventListener('mousedown', mouseHandler);
                document.addEventListener('wheel', wheelHandler);
                document.body.appendChild(keyDetectorOverlay);
            });
        }

        // builders exporter
        function exportBuilders() {
            const content =
                `//poyakong.cfg\n` +
                `//template builder\n` +
                bindings.map(binding => {
                    return `//${binding.description}\n` +
                        `//${binding.bind}\n` +
                        `//${binding.command}\n` +
                        `//${binding.tag}\n`;
                }).join('');

            // Create a file and write the content to it with name poyakong.cfg
            const file = new File([content], 'poyakong.cfg', { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(file);
            link.download = 'poyakong.cfg';

            // Trigger download
            link.click();

            // Show success popup
            showPopup("Builderå¯¼å‡ºæˆåŠŸ", 'popupContainer');
        }

        // window.onload for ç”Ÿäº§ç¯å¢ƒ
        window.onload = () => {
            const fileContent = "//poyakong.cfg\n//CS2 æŒ‰é”®ç»‘å®šåŠ©æ‰‹ for ZED (2024-12-14)\n//ä½œè€…: ç ´äºšç©º-Yakong-P\n//æ–‡ä»¶æ„ç­‘: 2024/12/14 11:00:56\n\n\n//ä½¿ç”¨æ–¹æ³•ï¼š\n//1ã€å°†æœ¬æ–‡ä»¶æ”¾ç½®äºCounterStrike: Global Offesive/game/csgo/cfgæ–‡ä»¶å¤¹ä¸­\n//2ã€æ‰“å¼€æ¸¸æˆ\n//3ã€åœ¨CS2è®¾ç½®é‡Œï¼Œå¯ç”¨æ§åˆ¶å°\n//4ã€åœ¨æ§åˆ¶å°é‡Œï¼Œè¾“å…¥exec poyakong.cfgï¼Œç„¶åå›è½¦ç¡®è®¤\n//5ã€å¦‚æœå¯¼å…¥æˆåŠŸï¼Œåˆ™ä¼šæ˜¾ç¤ºä¸€å †çš„ç»‘å®šçš„ä¿¡æ¯\n//6ã€å¦‚æœå¯¼å…¥å¤±è´¥ï¼Œåˆ™ä¼šäº§ç”Ÿä¸€æ¡æ‰§è¡Œå¤±è´¥çš„ä¿¡æ¯ï¼š[InputService] exec: couldn't exec '{*}cfg/xxx.cfg', unable to read file\n\n\n\n\n\n\n//json-templates\n//[{\"description\":\"[å…¬å‘Š]â¬†ï¸å–„ç”¨å…¨å±€æœç´¢â­ä¸ªäººæœ€çˆ±âš ï¸æ³¨æ„äº‹é¡¹\",\"bind\":\"\",\"command\":\"\",\"tag\":[]},{\"description\":\"[å…¬å‘Š]âš ï¸ä½¿ç”¨æ•™ç¨‹ï¼š1ã€ç‚¹å‡»è®¾ç½®ï¼Œç„¶åæŒ‰ä¸‹é”®ç›˜è¦ç»‘å®šçš„æŒ‰é”® 2ã€æ‹–æ‹½ä½ è¦ç”¨çš„æŒ‡ä»¤ï¼Œè‡³å·¦ä¸Šè§’ï¼Œè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªåˆ‡æ¿ 3ã€è¿›å…¥æ¸¸æˆï¼Œåœ¨æ§åˆ¶å°å†…[ctrl+v]ï¼Œ[enter]å›è½¦è¿è¡Œ\",\"bind\":\"\",\"command\":\"\",\"tag\":[]},{\"description\":\"[å…¬å‘Š]âš ï¸è§†é¢‘æ•™ç¨‹ï¼š\",\"bind\":\"\",\"command\":\"\",\"tag\":[\"å…¬å‘Š\",\"BV1d1zkYSEgN\",\"https://www.bilibili.com/video/BV1d1zkYSEgN/\"]},{\"description\":\"[å…¬å‘Š]âš ï¸å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œè®°å¾—å°†é…ç½®æ–‡ä»¶autoexec.cfgæ”¾ç½®åˆ°Counter-Strike Global Offensive\\\\game\\\\csgo\\\\cfgæ–‡ä»¶å¤¹ä¸­ï¼ï¼ï¼\",\"bind\":\"\",\"command\":\"\",\"tag\":[]},{\"description\":\"[æŒ‰é”®è®¾ç½®]å•é”®è§£é™¤ç»‘å®šï¼Œå–æ¶ˆç»‘å®š\",\"bind\":\"\",\"command\":\"unbind [key];\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°ZEé“å…·]é«˜çˆ†æ‰‹é›·\",\"bind\":\"\",\"command\":\"bind [key] \\\"buy hegrenade\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°ZEé“å…·]ZEDå›è¡€é’ˆ(ç”µå‡»æª)\",\"bind\":\"\",\"command\":\"bind [key] \\\"buy taser\\\";\",\"tag\":[]},{\"description\":\"[ZED][æŒ‰é”®ç»‘å®š]æå‡º - å›è¡€é’ˆ\",\"bind\":\"\",\"command\":\"bind [key] \\\"slot12\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°ZEé“å…·]å†°å†»é›·(çƒŸé›¾å¼¹)\",\"bind\":\"\",\"command\":\"bind [key] \\\"buy smokegrenade\\\";\",\"tag\":[]},{\"description\":\"[ZED][æŒ‰é”®ç»‘å®š]æå‡º - å†°å†»é›·\",\"bind\":\"\",\"command\":\"bind [key] \\\"slot8\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°ZEé“å…·]ç‡ƒçƒ§ç“¶(ç‡ƒçƒ§å¼¹)\",\"bind\":\"\",\"command\":\"bind [key] \\\"buy molotov\\\";\",\"tag\":[]},{\"description\":\"[ZED][æŒ‰é”®ç»‘å®š]æå‡º - ç‡ƒçƒ§ç“¶\",\"bind\":\"\",\"command\":\"bind [key] \\\"slot10\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°ZEé“å…·]è¡¥å……æŠ¤ç”²$1000\",\"bind\":\"\",\"command\":\"bind [key] \\\"buy vesthelm\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ­¥æª]ak47\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_ak47\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ­¥æª]m4a1\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_m4a1\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ­¥æª]m4a4\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_m4a4\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ­¥æª]SG556\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_sg556\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ­¥æª]AUG\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_aug\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ­¥æª]æ³•ç›æ–¯Famas\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_famas\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ­¥æª]å’–å–±Galilar - åŠ åˆ©å°”AR\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_galilar\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æœºæª]å†…æ ¼å¤«Negev\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_negev\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æœºæª]M249\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_m249\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][ç‹™å‡»æ­¥æª]SSG-08\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_ssg08\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][ç‹™å‡»æ­¥æª]AWP\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_awp\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][ç‹™å‡»æ­¥æª]SCAR-20\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_scar20\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][ç‹™å‡»æ­¥æª]G3SG1\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_g3sg1\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]Tec-9\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_tec9\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]Five-seven\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_Fiveseven\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]p250\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_p250\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]æ²™é¹°Deagle\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_deagle\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]å·¦è½®Revolver\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_revolver\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]åŒæªElite\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_elite\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]CZ-75\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_cz\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]usp\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_usp_silencer\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]Glock-18\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_glock188\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][æ‰‹æª]hkp2000\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_p2000\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][éœ°å¼¹æª]æ–°æ˜ŸNova\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_nova\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][éœ°å¼¹æª]Mag-7\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_mag7\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][éœ°å¼¹æª]çŸ­å–·sawedoff\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_sawedoff\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][éœ°å¼¹æª]è¿å–·xm1014\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_xm1014\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][å†²é”‹æª]é‡ç‰›Bizon\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_bizon\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][å†²é”‹æª]MP9\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_mp9\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][å†²é”‹æª]P90\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_p90\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][å†²é”‹æª]MP7\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_mp7\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][å†²é”‹æª]MP5-SD\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_mp5\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][å†²é”‹æª]UMP-45\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_ump45\\\";\",\"tag\":[]},{\"description\":\"[ZED][è´­ä¹°æ­¦å™¨][å†²é”‹æª]Mac-10\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_mac10\\\";\",\"tag\":[]},{\"description\":\"[ZED][å¨±ä¹å‘]ï¼ˆâ”ï¼‰å¯¹äººæŒ‰ä¸‹æ—¶ï¼Œäº§ç”Ÿä¸€ä¸ªä¼šè·Ÿè¸ªçš„çº¢è‰²æ ‡è®°\",\"bind\":\"\",\"command\":\"bind [key] \\\"cl_ent_viewoffset\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ è¡€è¿¹æ˜¾ç¤º!toggledecals\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_toggledecals\\\";\",\"tag\":[]},{\"description\":\"[ZED][å¿«æ·åŠŸèƒ½]æŸ¥çœ‹è‡ªå·±æœ‰æ²¡æœ‰ç‰¹æ®Šå°ç¦!status\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_status\\\";\",\"tag\":[]},{\"description\":\"[ZED][å¿«æ·åŠŸèƒ½]ä½œä¸ºåƒµå°¸ä¼ é€å›å‡ºç”Ÿç‚¹!ztele\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_ztele\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]ä¿®å¤æ‚¬æµ®èœå•ä½ç½®é£˜èµ°æ¶ˆå¤±çš„é—®é¢˜!resethud   [èœå•ä¿®å¤]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_resethud\\\";\",\"tag\":[]},{\"description\":\"[ZED][åœ°å›¾]å‘¼å‡ºæŒ‡æŒ¥æŠ•ç¥¨èœå•!vl\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_vl\\\";\",\"tag\":[]},{\"description\":\"[ZED][æŠ•ç¥¨]æŠ•ç¥¨å»¶é•¿åœ°å›¾!ve\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_ve\\\";\",\"tag\":[]},{\"description\":\"[ZED][åœ°å›¾]æŸ¥çœ‹åœ°å›¾å‰©ä½™å»¶é•¿æ¬¡æ•°!extendsleft\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_extendsleft\\\";\",\"tag\":[]},{\"description\":\"[ZED][åœ°å›¾]æŸ¥çœ‹åœ°å›¾å‰©ä½™æ—¶é—´!timeleft\",\"bind\":\"\",\"command\":\"bind [key] \\\"timeleft\\\";\",\"tag\":[]},{\"description\":\"[ZED][åœ°å›¾]æŸ¥çœ‹å·²é¢„è®¢åœ°å›¾!nomlist\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_nomlist\\\";\",\"tag\":[]},{\"description\":\"[ZED][åœ°å›¾]åœ¨æ§åˆ¶å°æ˜¾ç¤ºæœåŠ¡å™¨çš„åœ°å›¾æ± !listmap\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_nomlist\\\";\",\"tag\":[]},{\"description\":\"[ZED][åœ°å›¾]åœ¨æ§åˆ¶å°æ˜¾ç¤ºæ‰€æœ‰CDä»åœ¨å†·å´çš„åœ°å›¾!mapcooldowns\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_mapcooldowns\\\";\",\"tag\":[]},{\"description\":\"[ZED][åœ°å›¾]æˆ‘çªç„¶ä¸æƒ³RTVäº†!unrtv\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_rtv\\\";\",\"tag\":[]},{\"description\":\"[ZED][åœ°å›¾]æˆ‘è¦R!T!V! - è¯·æ±‚æ¢å›¾!rtv\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_rtv\\\";\",\"tag\":[]},{\"description\":\"[ZED][èœå•]å‘¼å‡ºä¸»èœå•!menu\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_menu\\\";\",\"tag\":[]},{\"description\":\"[ZED][èœå•]å‘¼å‡ºç”»é¢è®¾ç½®èœå•!hud\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hud\\\";\",\"tag\":[]},{\"description\":\"[ZED][èœå•]å‘¼å‡ºä¸ªäººæ‚é¡¹è®¾ç½®èœå•!settings\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_settings\\\";\",\"tag\":[]},{\"description\":\"[ZED][èœå•]å‘¼å‡ºè·³èˆèœå•!dance\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_dance\\\";\",\"tag\":[]},{\"description\":\"[ZED][èœå•]å‘¼å‡ºåƒµå°¸ç±»å‹é€‰æ‹©èœå•!zclass\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_zlass\\\";\",\"tag\":[]},{\"description\":\"[ZED][èœå•]å‘¼å‡ºçš®è‚¤å•†åŸèœå•!skin\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_skin\\\";\",\"tag\":[]},{\"description\":\"[ZED][åŠŸèƒ½]ä¼ é€å›å‡ºç”Ÿç‚¹!ztele\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_ztele\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]éšè—ç¬¦å¡å¼¹å¹•ç‰¹æ•ˆ!hideeffect   [åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hideeffect\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]â­å¯ç”¨å¤œè§†ä»ªï¼Œåœ°å›¾æ»¤é•œåˆ‡æ¢   [å¼€/å…³]\",\"bind\":\"\",\"command\":\"bind [key] \\\"mapFilter_0\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ å­å¼¹æ›³å…‰æ•ˆæœï¼ˆå…¨å±€æ‰€æœ‰äººï¼‰[åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"incrementvar r_drawtracers 0 1 1\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ ç¬¬ä¸€äººç§°çš„å­å¼¹æ›³å…‰æ•ˆæœï¼ˆä»…è‡ªèº«ï¼‰[åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"incrementvar r_drawtracers_firstperson 0 1 1\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€å¯/å…³é—­ å±å¹•æ™ƒåŠ¨!toggleshake   [åˆ‡æ¢][å±å¹•éœ‡åŠ¨]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hideshake\\\";\",\"tag\":[]},{\"description\":\"[ZED][éŸ³æ•ˆ]å¼€/å…³ æªå£°!stopsound   [åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_stopsound\\\";\",\"tag\":[]},{\"description\":\"[ZED][éŸ³æ•ˆ]å¼€/å…³ åƒµå°¸è¢«æ‰“å¤´çš„å£°éŸ³!togglehit   [åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_togglehit\\\";\",\"tag\":[]},{\"description\":\"[ZED][éŸ³æ•ˆ]è°ƒæ•´éŸ³é‡ - æ¸¸æˆéŸ³ä¹(BGM)ï¼ˆå¢å¤§8%ï¼‰[+]\",\"bind\":\"\",\"command\":\"bind [key] \\\"incrementvar snd_musicvolume -0.1 1.1 0.08\\\";\",\"tag\":[]},{\"description\":\"[ZED][éŸ³æ•ˆ]è°ƒæ•´éŸ³é‡ - æ¸¸æˆéŸ³ä¹(BGM)ï¼ˆå‡å°8%ï¼‰[-]\",\"bind\":\"\",\"command\":\"bind [key] \\\"incrementvar snd_musicvolume -0.1 1.1 -0.08\\\";\",\"tag\":[]},{\"description\":\"[ZED][éŸ³æ•ˆ]è°ƒæ•´éŸ³é‡ - é˜Ÿå‹è¯­éŸ³ï¼ˆå¢å¤§8%ï¼‰[+]\",\"bind\":\"\",\"command\":\"bind [key] \\\"incrementvar snd_voipvolume -0.1 2.1 0.08\\\";\",\"tag\":[]},{\"description\":\"[ZED][éŸ³æ•ˆ]è°ƒæ•´éŸ³é‡ - é˜Ÿå‹è¯­éŸ³ï¼ˆå‡å°8%ï¼‰[-]\",\"bind\":\"\",\"command\":\"bind [key] \\\"incrementvar snd_voipvolume -0.1 2.1 -0.08\\\";\",\"tag\":[]},{\"description\":\"[ZED][éŸ³æ•ˆ]è°ƒæ•´éŸ³é‡ - æ¸¸æˆæ€»è¯­éŸ³ï¼ˆå¢å¤§5%ï¼‰[+]\",\"bind\":\"\",\"command\":\"bind [key] \\\"incrementvar volume -0.1 1.1 0.05\\\";\",\"tag\":[]},{\"description\":\"[ZED][éŸ³æ•ˆ]è°ƒæ•´éŸ³é‡ - æ¸¸æˆæ€»è¯­éŸ³ï¼ˆå‡å°5%ï¼‰[-]\",\"bind\":\"\",\"command\":\"bind [key] \\\"incrementvar volume -0.1 1.1 -0.05\\\";\",\"tag\":[]},{\"description\":\"[ZED][éŸ³æ•ˆ]å¼€/å…³ å£°éŸ³ç©¿é€ - æ¸¸æˆåˆ‡å‡ºæ¡Œé¢åï¼Œä¾ç„¶æ’­æ”¾æ¸¸æˆå£°éŸ³\",\"bind\":\"\",\"command\":\"bind [key] \\\"incrementvar snd_mute_losefocus 0 1 1\\\";\",\"tag\":[]},{\"description\":\"[ZED][èœå•]â­å‘¼å‡ºéšè—æ¨¡å‹ï¼Œéšè—ç‰¹æ•ˆçš„æ•´åˆèœå•\",\"bind\":\"\",\"command\":\"bind [key] \\\"radio1\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ éšè—èº«è¾¹1unitçš„é˜Ÿå‹ï¼ˆä½œä¸ºäººç±»æ—¶ï¼‰[åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hide 0\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ éšè—èº«è¾¹50unitçš„é˜Ÿå‹ï¼ˆä½œä¸ºäººç±»æ—¶ï¼‰[åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hide 50\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ éšè—èº«è¾¹150unitçš„é˜Ÿå‹ï¼ˆä½œä¸ºäººç±»æ—¶ï¼‰[åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hide 150\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ éšè—èº«è¾¹250unitçš„é˜Ÿå‹ï¼ˆä½œä¸ºäººç±»æ—¶ï¼‰[åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hide 250\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ éšè—èº«è¾¹9999unitçš„é˜Ÿå‹ï¼ˆä½œä¸ºäººç±»æ—¶ï¼‰[åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hide -1\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ ç»ä¸éšè—å¤„äºç™½åå•çš„é˜Ÿå‹ - éœ€è¦åœ¨zedèŠå¤©æ¡†è¾“å…¥!setting -> éšè—ç›¸å…³è®¾ç½® -> ä¸éšè—æŒ‡å®šçš„ç©å®¶ ->æ·»åŠ ç™½åå•   [åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hidefriends\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç”»é¢æ˜¾ç¤º]å¼€/å…³ ç»ä¸éšè—steamå¥½å‹çš„æ¨¡å‹!hidesteamfriends   [åˆ‡æ¢]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_hidesteamfriends\\\";\",\"tag\":[]},{\"description\":\"[ZED][ç¬¬ä¸‰äººç§°åˆ‡æ¢]â­å¯ç”¨ç¬¬ä¸‰äººç§°ï¼Œæ¢å¤ç¬¬ä¸€äººç§°ï¼ˆè§’åº¦ä¿æŒï¼‰[tp]\",\"bind\":\"\",\"command\":\"bind [key] tp_0;\",\"tag\":[]},{\"description\":\"[ZED][ç¬¬ä¸‰äººç§°åˆ‡æ¢][æ€€æ—§ç‰ˆæœ¬]CSGOç‰ˆæœ¬çš„!tpï¼Œç¬¬ä¸‰äººç§°ï¼Œç¬¬ä¸‰äººç§°å›ºå®šæ‘„åƒæœºè§‚èµæ¨¡å¼!mirror(mayamode)ï¼Œç¬¬ä¸€äººç§°\",\"bind\":\"\",\"command\":\"bind [key] \\\"mayamode_0\\\";\",\"tag\":[]},{\"description\":\"[ZED]ğŸ”„é‡ç½®ç¬¬ä¸‰äººç§°çš„æ‘„åƒæœºä½ç½®\",\"bind\":\"\",\"command\":\"bind [key] \\\"cam_command 1;c_thirdpersonshoulder 0;cam_idealyaw 0;cam_idealpitch 0;cam_idealdist 150\\\";c_thirdpersonshoulderheight 5;c_thirdpersonshoulderoffset 20;\",\"tag\":[]},{\"description\":\"[ZED]ç¬¬ä¸‰äººç§° - å‡†æ˜Ÿå¾®è°ƒ[ä¸Š]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_minpitch -180;c_maxpitch 180;incrementvar cam_idealpitch -90 90 -0.1\\\";\",\"tag\":[]},{\"description\":\"[ZED]ç¬¬ä¸‰äººç§° - å‡†æ˜Ÿå¾®è°ƒ[ä¸‹]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_minpitch -180;c_maxpitch 180;incrementvar cam_idealpitch -90 90 0.1\\\";\",\"tag\":[]},{\"description\":\"[ZED]ç¬¬ä¸‰äººç§° - å‡†æ˜Ÿå¾®è°ƒ[å·¦]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_minyaw -180;c_maxyaw 180;incrementvar cam_idealyaw -180 180 0.1\\\";\",\"tag\":[]},{\"description\":\"[ZED]ç¬¬ä¸‰äººç§° - å‡†æ˜Ÿå¾®è°ƒ[å³]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_minyaw -180;c_maxyaw 180;incrementvar cam_idealyaw -180 180 -0.1\\\";\",\"tag\":[]},{\"description\":\"[ZED]ç¬¬ä¸‰äººç§° - è§†è§’ä½ç½®[æ‹‰è¿‘]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_mindistance -500;c_maxdistance 500;incrementvar cam_idealdist -510 510 -5\\\";\",\"tag\":[]},{\"description\":\"[ZED]ç¬¬ä¸‰äººç§° - è§†è§’ä½ç½®[æ‹‰è¿œ]\",\"bind\":\"\",\"command\":\"bind [key] \\\"c_mindistance -500;c_maxdistance 500;incrementvar cam_idealdist -510 510 5\\\";\",\"tag\":[]},{\"description\":\"[ZED][è§‚èµä¸“ç”¨]ä½¿ç”¨ç¬¬ä¸‰äººç§°è¿‘è·ç¦»è§‚èµè§’è‰²æ­£è„¸ï¼Œè®©è§’è‰²çœ‹ç€ä½    ï¼ˆåªé€‚é…äº†æ­£å¸¸é«˜åº¦çš„è§’è‰²ï¼‰ï¼ˆéœ€è¦å¤šæŒ‰å‡ æ¬¡è°ƒæ•´ï¼Œå› ä¸ºä¸åŒè§’è‰²è§†è§’çš„æ–¹å‘æœ‰ç»†å¾®å·®åˆ«ï¼‰\",\"bind\":\"\",\"command\":\"bind [key] \\\"cam_command 1;c_thirdpersonshoulder 1;c_minyaw -360;c_maxyaw 360;c_thirdpersonshoulderheight 0;c_thirdpersonshoulderoffset 2;cam_idealdist 30;incrementvar cam_idealyaw 170 179.9 0.5\\\";\",\"tag\":[]},{\"description\":\"[é€šç”¨][è´­ä¹°é“å…·]é’³å­Defuser\",\"bind\":\"\",\"command\":\"bind [key] \\\"buy defuser\\\";\",\"tag\":[]},{\"description\":\"[é€šç”¨][è´­ä¹°é“å…·]é—ªå…‰å¼¹Flashbang\",\"bind\":\"\",\"command\":\"bind [key] \\\"buy flashbang\\\";\",\"tag\":[]},{\"description\":\"[é€šç”¨][è´­ä¹°é“å…·]è¯±é¥µå¼¹Decoy\",\"bind\":\"\",\"command\":\"bind [key] \\\"buy decoy\\\";\",\"tag\":[]},{\"description\":\"[é€šç”¨][è´­ä¹°é“å…·]æ— å¤´æŠ¤ç”²$650\",\"bind\":\"\",\"command\":\"bind [key] \\\"buy vest\\\";\",\"tag\":[]}]\n\n//json-templates\n//[]";

            setTimeout(() => {
                // currentFile = null; // ä¸€è¾ˆå­æ²¡ç”¨è¿‡çš„å‡½æ•°
                dropArea.style.display = 'none';
                removeHiddens();
                loadBindingsFromFile(fileContent);
                showPopup("æ¬¢è¿ä½¿ç”¨CS2æŒ‰é”®åŠ©æ‰‹ï¼" + new Date().toLocaleString(), 'popupContainer'); // æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯ + å½“å‰çš„æ—¶é—´
            }, 500);

            // 20250117 localStorage support ğŸ’¿ {color:#784D37}
            if (localStorageEnabled == true) {
                // retrieve localStorage
                bindings = JSON.parse(localStorage.getItem('poyakong_bindings')) || [];
                originalRenderBindings();
            }

            // 20250117 cookies ğŸª {color:#784D37}
            if (cookiesEnabled == true && document.cookie.length > 0) {
                bindings = JSON.parse.decodeURIComponent((getCookie('poyakong_bindings')));
                originalRenderBindings();
            }
        }

        addEventListener('beforeunload', function (event) {

            // 20250117 localStorage support ğŸ’¿ {color:#784D37}
            if (localStorageEnabled == true) {
                // store localStorage
                localStorage.setItem('poyakong_bindings', JSON.stringify(bindings));
            }

            // 20250117 cookies support ğŸª {color:#784D37}
            if (cookiesEnabled == true) {
                // store cookies
                setCookie('poyakong_bindings', encodeURIComponent(JSON.stringify(bindings)), 365);
            }
        });

        // 20250117 cookies support - functions ğŸª {color:#784D37}
        function setCookie(key, value = "", daysToExpired = 30) {
            const date = new Date();
            date.setTime(date.getTime() + (daysToExpired * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = `${key}=${value}; ${expires}; path=/`;
        }

        function getCookie(key) {
            const name = key + "=";
            const decodedCookie = decodeURIComponent(document.cookie);
            const cArray = decodedCookie.split('; ');

            for (let i = 0; i < cArray.length; i++) {
                let c = cArray[i];
                while (c.charAt(0) === ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) === 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function deleteCookie(key) {
            document.cookie = `${key}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/`;
        }

    </script>
</body>

</html>